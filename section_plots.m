clear all; clc;
ptCloud        = pcread(['Y:\livox\livox_processed\2022-01-30_10-57-43_MERGED.ply']);
%ptCloud        = pcread(['Y:\livox\livox_processed - 20230504\2022-05-19_05-59-56_scan01_trans_MATCHED_TRANSFORMED.ply']);


ptCloud_area{1}      = [1.76, 5.81, 0; ...
    1.76, 5.81, 8.00; ...
    1.86, 5.81, 0.00; ...
    1.86, 5.81, 8.00; ...
    8.2, 3.00, 0.00; ...
    8.2, 3.00, 8.00; ...
    8.3, 3.00, 0.00; ...
    8.3, 3.00, 8.00; ...
    ];

ptCloud_area{2}      = [19.68, 45.4, 0; ...
    19.68, 45.4, 8.00; ...
    19.78, 45.4, 0.00; ...
    19.78, 45.4, 8.00; ...
    29.9, 41.4, 0.00; ...
    29.9, 41.4, 8.00; ...
    30.0, 41.4, 0.00; ...
    30.0, 41.4, 8.00; ...
    ];

ptCloud_area = ptCloud_area{1};


x = min(ptCloud_area(:,1)):0.10:max(ptCloud_area(:,1));
y = min(ptCloud_area(:,2)):0.10:max(ptCloud_area(:,2));
z = min(ptCloud_area(:,3)):0.10:max(ptCloud_area(:,3));
[X,Y] = meshgrid(x,y);

shp = alphaShape(ptCloud_area(:,1),ptCloud_area(:,2),ptCloud_area(:,3),1000,...
    'HoleThreshold',10000);
h = plot(shp);
Vertices = h.Vertices;
Faces = h.Faces;
close all

t1 = inpolyhedron(Faces,Vertices,ptCloud.Location);
indices = find(t1>0);
scatter3(ptCloud.Location(indices,1),ptCloud.Location(indices,2),ptCloud.Location(indices,3)); hold on;
%F = scatteredInterpolant(double(ptCloud.Location(indices,1)),double(ptCloud.Location(indices,2)),double(ptCloud.Location(indices,3))) 
%vq = F(X,Y);
%mesh(X,Y,vq,'LineStyle', 'none', 'FaceColor','r'); hold on;

ptCloud2        = pcread(['Y:\livox\livox_processed\2022-03-31_17-59-00_MERGED.ply']);
%ptCloud2        = pcread(['Y:\livox\livox_processed - 20230504\2022-05-19_05-59-56_scan02_TRANSFORMED.ply']);
t2 = inpolyhedron(Faces,Vertices,ptCloud2.Location);
indices = find(t2>0);
scatter3(ptCloud2.Location(indices,1),ptCloud2.Location(indices,2),ptCloud2.Location(indices,3))
%F = scatteredInterpolant(double(ptCloud2.Location(indices,1)),double(ptCloud2.Location(indices,2)),double(ptCloud2.Location(indices,3))) 
%vq = F(X,Y);
%mesh(X,Y,vq,'LineStyle', 'none', 'FaceColor','b'); hold on;
